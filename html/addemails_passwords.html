<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Graph</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script src = "https://d3js.org/d3-shape.v1.min.js"></script>
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <script src="js/jquery.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/jquery-menu.js"></script>
        <link rel="stylesheet" type="text/css" href="css/jquery-menu.css" />
        <script> 
            // create a graph class 
            class Graph { 
                

                
                // defining variables
                constructor() 
                { 
                    //Used for Visualisation (Bipartite Graph)
                    this.Accounts = new Array();
                    this.Passwords = new Array();
                    this.Links = new Array();
                    
                    //Used to create JSON
                    this.JSON = new Object();
                    this.Nodes = new Array();
                    this.Edges = new Array();
                    
                    this.currentNode = new Object();
                    this.currentPassword = new Object();
                    
                    this.currentNodeID = 1;
                    this.currentEdgeID = 1;
                    this.currentEmailLevel = 1;
                    this.currentPasswordLevel = 1;
                    this.currentEmailPOS = 50;
                    this.currentPasswordPOS = 50;
                    this.nodeInfoNeeded = "none";
                    this.nodeLinkA = [];
                    this.nodeLinkB = [];
                }             

                // add account to left hand side of the graph 
                addEmail(name) 
                { 
                    var account = {
                        "id": this.currentNodeID,
                        "x_axis":50,
                        "y_axis":this.currentEmailPOS,
                        "name":name,
                        "color":"red"
                    };
                    
                    this.Accounts.push(account);
                    
                    this.currentNode.id = this.currentNodeID;
                    this.currentNode.label = name;
                    this.currentNode.x = "";
                    this.currentNode.y = "";
                    this.currentNode.size = 10;
                    this.currentNode.type = "star";
                    this.currentNode.color = "#f00";

                    this.Nodes.push(this.currentNode);
                    this.JSON.nodes = (this.Nodes);
                    this.currentNode = {};
                    
                    this.currentEmailLevel = this.currentEmailLevel+1;
                    this.currentNodeID++;
                    this.currentEmailPOS = this.currentEmailPOS + 50;
                } 
                
                // add vertex to the right hand side of the graph
                addPassword(name) 
                { 
                    var account = {
                        "id": this.currentNodeID,
                        "x_axis":160,
                        "y_axis":this.currentPasswordPOS,
                        "name":name,
                        "color":"blue"
                    };
                    
                    this.Accounts.push(account);
                    this.Passwords.push(account);
                    
                    this.currentPassword.id = this.currentNodeID;
                    this.currentPassword.label = name;
                    this.currentPassword.x = "";
                    this.currentPassword.y = "";
                    this.currentPassword.size = 10;
                    this.currentPassword.color = "#f00";

                    this.Nodes.push(this.currentPassword);
                    this.JSON.nodes = (this.Nodes);
                    this.currentPassword = {};
                    
                    this.currentPasswordLevel = this.currentPasswordLevel+1; 
                    this.currentNodeID++;
                    this.currentPasswordPOS = this.currentPasswordPOS + 50;
                }

                // add edge to the graph 
                addLink(x1, y1, x2, y2) 
                { 
                    var link1 = {
                        "x": x1 + 20,
                        "y": y1 + 10
                    };
                    
                    var link2 = {
                        "x": x2 + 20,
                        "y": y2 + 10
                    };
                    
                    var Link = [];
                    Link.push(link1);
                    Link.push(link2);
                    this.Links.push(Link);
                    console.log(this.Links);
                }
                
                // Prints the vertex and adjacency list 
                drawGraph() 
                { 
                    var width = 400;
         
                    var height = 400;

                    var data = this.Accounts;
                    
                    var edgeData = this.Links;
                    
                    var svgContainer = d3.select("#graph").append("svg")
                       .attr("width", width)
                       .attr("height", height);
               
                    var line = d3.line()
                        .x(function (d) { return d.x; })
                        .y(function (d) { return d.y; });
                
                    for (var i=0; i < edgeData.length; i++) 
                        {
                            svgContainer.append("path")
                                .attr("class", "line")
                                .datum(edgeData[i])
                                .attr("d", line)
                                .attr("stroke", "black")
                                .attr("stroke-width", 2);
                                
                            console.log(edgeData[i]);  
                        }

                    var rectangle = svgContainer.selectAll("rect")
                        .data(data)
                        .enter()
                        .append("rect");
                

                    rectangle.on('click', datum => {
                        this.nodeClicked=datum; // the datum for the clicked circle
                        if (this.nodeInfoNeeded === "end")
                        {
                            var x = this.nodeClicked.x_axis;
                            var y = this.nodeClicked.y_axis;
                            
                            this.getSecondNodeInfo(x,y);
                        }
                        if (this.nodeInfoNeeded === "start")
                        {
                            var x = this.nodeClicked.x_axis;
                            var y = this.nodeClicked.y_axis;
                            
                            this.getFirstNodeInfo(x,y);                           
                        }
                        
                        this.nodeClicked = {};
                    });
                
                    var rectangleAttributes = rectangle
                        .attr("x", function (d) { return d.x_axis; })
                        .attr("y", function (d) { return d.y_axis; })
                        .attr("width", 40)
                        .attr("height", 20)
                        .style("fill", function(d) { return d.color; });
                
                    //Add the SVG Text Element to the svgContainer
                    var text = svgContainer.selectAll("text")
                                            .data(data)
                                            .enter()
                                            .append("text");

                    //Add SVG Text Element Attributes
                    var textLabels = text
                                     .attr("x", function(d) { return d.x_axis + 5; })
                                     .attr("y", function(d) { return d.y_axis + 10; })
                                     .text( function (d) { return d.name; })
                                     .attr("font-family", "sans-serif")
                                     .attr("font-size", "10px")
                                     .attr("fill", "white");                
                }
                
                startLink()
                {
                    this.nodeInfoNeeded = "start";
                }
                
                getFirstNodeInfo(x,y)
                {
                    this.nodeLinkA = [x,y];
                    this.nodeInfoNeeded = "end";
                }
                
                getSecondNodeInfo(x,y)
                {
                    this.nodeLinkB = [x,y];
                    this.addLink(this.nodeLinkA[0], this.nodeLinkA[1], this.nodeLinkB[0], this.nodeLinkB[1]);
                    this.nodeInfoNeeded = "none";
                    this.nodeLinkA = [];
                    this.nodeLinkB = [];
                    this.refreshGraph();
                }
                
                addEmailNode(){
                    var name = document.getElementById('addemail').elements.emailname.value;
                    this.addEmail(name);
                    this.refreshGraph();
                }
                
                addPasswordNode(){
                    var name = document.getElementById('addpassword').elements.passwordname.value;
                    this.addPassword(name);
                    this.refreshGraph();
                }
                
                refreshGraph()
                {
                    d3.select("svg").remove();
                    this.drawGraph();
                }
            }
            
            
        </script>
    </head>
    <body>
        <div class="jumbotron text-center bg-gray text-white" style="background-color:#4365E1; padding-top:30; padding-bottom:0; margin-bottom:0;">
                <div class="container-fluid">
                    <div class ="row">
                        <div class="col-sm-4">
                            <img src="img/opengraph.jpg" class="img-fluid h-50" alt="UOD Logo"> 
                        </div>
                        <div class="col-sm-4">
                            <h1>Account Visualiser</h1>
                            <p>Add Email Accounts and Passwords</p>
                        </div>
                        <div class="col-sm-4"></div>
                    </div>
                </div>
        </div>
        <nav class="navbar navbar-expand-sm justify-content-center" style="background-color:#464646; margin-bottom:10px";>
            <ul class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link" href="index.html">Home</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="index.html">Back</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#">Help</a>
                </li>
            </ul>
        </nav>
        <script>
            var G = new Graph();
            G.addEmail("Gmail");
            G.addEmail("Hotmail");
            G.addPassword("1");
        </script>
        <div class="container">
            <div class="row">
                <div class="col-sm-4" id="graph" style="border:solid black 2px"></div>

                <script>
                    G.drawGraph();
                </script>
                <div class="col-sm-4">
                    <h2>Emails and Passwords</h2>
                    <p class="text-black-50">Use This form to add an Email address<p>
                    <form id="addemail">
                        <div class="form-group">
                        <label for="emailname">Email Name</label>
                        <input type="text" name="emailname" class="form-control" placeholder="ie. gmail">
                        </div>
                        <button name="data" type="button" onclick="G.addEmailNode()" class="btn btn-primary">Submit Email</button>
                    </form><br>
                    <br>
                    <p class="text-black-50">Use This form to add a Password<p>
                    <form id="addpassword">
                        <div class="form-group">
                        <label for="passwordname">Password Name</label>
                        <input type="text" name="passwordname" class="form-control" placeholder="ie. 1">
                        </div>
                        <button name="data" type="button" onclick="G.addPasswordNode()" class="btn btn-primary">Submit Password</button>
                    </form><br>
                </div>
                <div class="col-sm-4">
                <h2>Links</h2>
                <p class="text-black-50">Click this button to start the link process</p>
                <div class="form-group">
                <label for="data">Click to Start</label>
                <button name="data" type="button" onclick="G.startLink()" class="btn btn-primary">Add Link</button>
                </div>
                </div>
            </div>
        </div>

    </body>
</html>
